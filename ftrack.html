<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pennywise ¬∑ personal finance</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,400;14..32,500;14..32,600;14..32,700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <!-- Chart.js 3 (lightweight) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Poppins', sans-serif;
        }

        body {
            background: #f4f6fb;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            padding: 1rem;
        }

        /* main container with sidebar + content */
        .app {
            display: flex;
            width: 1400px;
            max-width: 100%;
            background: white;
            border-radius: 2.5rem;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.15);
            overflow: hidden;
            backdrop-filter: blur(2px);
            transition: all 0.2s ease;
        }

        /* ========== SIDEBAR ========== */
        .sidebar {
            width: 260px;
            background: white;
            padding: 2rem 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 2.5rem;
            border-right: 1px solid #f0f2f5;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 700;
            font-size: 1.5rem;
            color: #1e293b;
        }
        .logo i { color: #3b82f6; font-size: 2rem; }

        .nav {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .nav-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.85rem 1.2rem;
            border-radius: 1.5rem;
            color: #5b6878;
            font-weight: 500;
            transition: 0.2s;
            cursor: default;
        }
        .nav-item i { width: 1.6rem; font-size: 1.3rem; }
        .nav-item.active {
            background: #3b82f6;
            color: white;
            box-shadow: 0 10px 15px -3px rgba(59,130,246,0.3);
        }
        .nav-item:not(.active):hover {
            background: #f1f5f9;
            color: #1e293b;
        }

        /* ========== MAIN ========== */
        .main {
            flex: 1;
            background: #fbfdff;
            padding: 2rem 2.2rem;
            overflow-y: auto;
            max-height: 95vh;
        }

        /* top bar */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        .page-title { font-size: 1.8rem; font-weight: 600; color: #0f1825; }

        /* cards (dashboard) */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }
        .stat-card {
            background: white;
            padding: 1.6rem 1.4rem;
            border-radius: 2rem;
            box-shadow: 0 8px 20px -6px rgba(0, 0, 0, 0.05);
            transition: 0.2s;
            border: 1px solid #ffffff50;
            backdrop-filter: blur(4px);
        }
        .stat-card:hover { transform: translateY(-4px); box-shadow: 0 20px 25px -8px rgba(0,0,0,0.1); }
        .stat-title { color: #65748c; font-weight: 500; font-size: 0.95rem; }
        .stat-value { font-size: 2.2rem; font-weight: 700; color: #1f2a41; margin: 0.4rem 0 0.2rem; }
        .stat-sub { font-size: 0.9rem; color: #22c55e; } /* placeholder for small badge */

        /* charts row */
        .charts-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.8rem;
            margin-bottom: 2.5rem;
        }
        .chart-card {
            background: white;
            border-radius: 2rem;
            padding: 1.5rem 1.2rem 1rem;
            box-shadow: 0 8px 22px -10px rgba(0,0,0,0.06);
            border: 1px solid #f1f4f9;
        }
        .chart-title { font-weight: 600; margin-bottom: 0.8rem; color: #2d3954; }

        /* forms and budget row */
        .action-panel {
            display: grid;
            grid-template-columns: 1.2fr 0.9fr;
            gap: 1.8rem;
            margin-bottom: 2.5rem;
        }
        .form-card, .budget-card {
            background: white;
            border-radius: 2rem;
            padding: 1.5rem 1.6rem;
            box-shadow: 0 8px 22px -10px rgba(0,0,0,0.04);
            border: 1px solid #f1f4f9;
        }
        .form-title { font-weight: 600; margin-bottom: 1.2rem; color: #2d3954; }

        .input-row {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
            margin-bottom: 1rem;
            align-items: center;
        }
        .input-row input, .input-row select, .input-row button {
            padding: 0.8rem 1rem;
            border-radius: 1.5rem;
            border: 1.5px solid #e9ecf2;
            background: white;
            font-size: 0.95rem;
            outline: none;
            transition: 0.15s;
        }
        .input-row input:focus, .input-row select:focus { border-color: #3b82f6; }
        .btn {
            background: #3b82f6;
            color: white;
            font-weight: 600;
            border: none;
            padding: 0.8rem 1.8rem;
            border-radius: 2rem;
            cursor: pointer;
            box-shadow: 0 6px 12px -6px #3b82f6b0;
            transition: 0.15s;
        }
        .btn-outline {
            background: white;
            color: #3b82f6;
            border: 1.5px solid #3b82f6;
            box-shadow: none;
        }
        .btn-outline:hover { background: #eef5ff; }

        .budget-input {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            flex-wrap: wrap;
            margin: 1rem 0;
        }
        .budget-warning {
            background: #fee2e2;
            color: #b91c1c;
            padding: 0.8rem 1.2rem;
            border-radius: 2rem;
            font-weight: 500;
            display: none;
            align-items: center;
            gap: 0.5rem;
        }
        .budget-warning.show { display: flex; }

        /* transaction table + filters */
        .table-section {
            background: white;
            border-radius: 2rem;
            padding: 1.5rem 1.5rem 0.5rem;
            box-shadow: 0 8px 22px -10px rgba(0,0,0,0.04);
        }
        .filter-bar {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1.8rem;
        }
        .filter-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: #f4f7fd;
            padding: 0.4rem 1rem;
            border-radius: 3rem;
        }
        .filter-item select, .filter-item input {
            border: none;
            background: transparent;
            font-weight: 500;
            padding: 0.3rem;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th {
            text-align: left;
            padding: 1rem 0.5rem;
            color: #5d6b85;
            font-weight: 600;
            font-size: 0.9rem;
        }
        td {
            padding: 0.9rem 0.5rem;
            border-top: 1px solid #edf2f7;
        }
        .category-badge {
            background: #e4ecfa;
            color: #1e3b77;
            padding: 0.3rem 1rem;
            border-radius: 2rem;
            font-size: 0.85rem;
            font-weight: 500;
        }
        .action-icons i {
            margin: 0 6px;
            color: #7b8ba5;
            cursor: pointer;
            transition: 0.1s;
        }
        .action-icons i:hover { color: #3b82f6; }
        .fa-trash-alt:hover { color: #ef4444 !important; }

        /* empty state */
        .empty-row td { text-align: center; padding: 2rem; color: #a5b3cc; }

        /* mobile */
        @media (max-width: 1000px) {
            .app { flex-direction: column; }
            .sidebar { width: 100%; border-right: none; border-bottom: 1px solid #eef2f6; }
            .card-grid { grid-template-columns: 1fr 1fr; }
            .charts-row { grid-template-columns: 1fr; }
            .action-panel { grid-template-columns: 1fr; }
        }
        @media (max-width: 600px) {
            .card-grid { grid-template-columns: 1fr; }
            .main { padding: 1.5rem; }
        }
    </style>
</head>
<body>
<div class="app">
    <!-- SIDEBAR -->
    <aside class="sidebar">
        <div class="logo"><i class="fas fa-coins"></i> Pennywise</div>
        <nav class="nav">
            <div class="nav-item active"><i class="fas fa-chart-pie"></i> Dashboard</div>
            <div class="nav-item"><i class="fas fa-arrow-down"></i> Income</div>
            <div class="nav-item"><i class="fas fa-arrow-up"></i> Expenses</div>
            <div class="nav-item"><i class="fas fa-wallet"></i> Budget</div>
            <div class="nav-item"><i class="fas fa-history"></i> History</div>
        </nav>
        <div style="margin-top: auto; font-size:0.9rem; color:#afbed3;"><i class="fas fa-database"></i> stored locally</div>
    </aside>

    <!-- MAIN PANEL -->
    <main class="main">
        <!-- header -->
        <div class="top-bar">
            <h1 class="page-title">Dashboard</h1>
            <div style="display:flex; gap:0.8rem"><i class="fas fa-bell" style="color:#93a5c2;"></i><i class="fas fa-user-circle" style="font-size:1.8rem; color:#234578;"></i></div>
        </div>

        <!-- 4 stat cards (filled via JS) -->
        <div class="card-grid" id="statsGrid">
            <div class="stat-card"><div class="stat-title">Total Balance</div><div class="stat-value" id="totalBalance">$0</div><div class="stat-sub"></div></div>
            <div class="stat-card"><div class="stat-title">Total Income</div><div class="stat-value" id="totalIncome">$0</div><div class="stat-sub">+ all time</div></div>
            <div class="stat-card"><div class="stat-title">Total Expenses</div><div class="stat-value" id="totalExpenses">$0</div><div class="stat-sub"> </div></div>
            <div class="stat-card"><div class="stat-title">Savings</div><div class="stat-value" id="totalSavings">$0</div><div class="stat-sub">‚Üê income - exp</div></div>
        </div>

        <!-- CHARTS (pie + bar) -->
        <div class="charts-row">
            <div class="chart-card"><div class="chart-title"><i class="fas fa-chart-pie" style="margin-right:8px;"></i>Expenses by category</div><canvas id="pieChart" width="300" height="200"></canvas></div>
            <div class="chart-card"><div class="chart-title"><i class="fas fa-chart-bar" style="margin-right:8px;"></i>Monthly spending</div><canvas id="barChart" width="300" height="200"></canvas></div>
        </div>

        <!-- ADD INCOME/EXPENSE + BUDGET -->
        <div class="action-panel">
            <!-- left: forms -->
            <div class="form-card">
                <div class="form-title">‚ûï add transaction</div>
                <div class="input-row">
                    <select id="typeSelect"><option value="income">üí∞ Income</option><option value="expense">üí∏ Expense</option></select>
                    <input type="number" id="amountInput" placeholder="Amount" step="0.01">
                    <select id="categorySelect"><option>Food</option><option>Rent</option><option>Travel</option><option>Shopping</option><option>Bills</option><option>Other</option></select>
                </div>
                <div class="input-row">
                    <input type="date" id="dateInput" value="2025-03-27">
                    <input type="text" id="noteInput" placeholder="Note (optional)">
                    <button class="btn" id="addBtn"><i class="fas fa-plus-circle"></i> Add</button>
                </div>
                <small style="color:#99a9c4;"><i class="far fa-save"></i> stored in browser</small>
            </div>
            <!-- right: budget card -->
            <div class="budget-card">
                <div class="form-title">üìÖ monthly budget</div>
                <div class="budget-input">
                    <input type="number" id="budgetLimit" placeholder="Set limit $" value="2000">
                    <button class="btn-outline" id="setBudgetBtn">Set</button>
                </div>
                <div class="budget-warning" id="budgetWarning"><i class="fas fa-exclamation-triangle"></i> Warning: expenses exceeded budget!</div>
                <div style="margin-top:0.8rem;">spent this month: <strong id="monthlySpent">$0</strong> / <span id="budgetDisplay">2000</span></div>
            </div>
        </div>

        <!-- TRANSACTION TABLE + FILTERS -->
        <div class="table-section">
            <div class="filter-bar">
                <div class="filter-item"><i class="fas fa-filter"></i><select id="filterCategory"><option value="all">All categories</option><option>Food</option><option>Rent</option><option>Travel</option><option>Shopping</option><option>Bills</option><option>Other</option></select></div>
                <div class="filter-item"><i class="fas fa-calendar"></i><input type="date" id="filterDate"></div>
                <button class="btn-outline" id="clearFilters" style="padding:0.4rem 1.6rem;">clear</button>
            </div>
            <div style="overflow-x:auto;">
                <table id="transactionTable">
                    <thead><tr><th>Type</th><th>Category</th><th>Amount</th><th>Date</th><th>Note</th><th>Actions</th></tr></thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>
    </main>
</div>

<script>
    (function() {
        // ********** DATA & LOCALSTORAGE **********
        let transactions = [];
        let monthlyBudget = 2000;   // default

        // Load from localStorage
        function loadData() {
            const stored = localStorage.getItem('pennywise_transactions');
            if (stored) {
                try { transactions = JSON.parse(stored); } catch(e){ transactions = []; }
            } else {
                // demo seed data (optional)
                transactions = [
                    {id: Date.now()-100000, type:'income', amount:3200, category:'Salary', date:getTodayString(), note:'March salary'},
                    {id: Date.now()-200000, type:'expense', amount:450, category:'Food', date:getTodayString(), note:'groceries'},
                    {id: Date.now()-300000, type:'expense', amount:1200, category:'Rent', date:getTodayString(), note:'March rent'},
                    {id: Date.now()-400000, type:'expense', amount:180, category:'Shopping', date:getTodayString(), note:'clothes'},
                ];
            }
            const budgetStored = localStorage.getItem('pennywise_budget');
            if (budgetStored) monthlyBudget = parseFloat(budgetStored) || 2000;
        }
        function saveTransactions() {
            localStorage.setItem('pennywise_transactions', JSON.stringify(transactions));
        }
        function saveBudget() {
            localStorage.setItem('pennywise_budget', monthlyBudget.toString());
        }

        // helpers
        function getTodayString() {
            const d = new Date();
            return d.toISOString().split('T')[0];
        }

        // ********** RENDER DASHBOARD & CHARTS **********
        let pieChart, barChart;

        function updateDashboard() {
            // totals
            let totalIncome = transactions.filter(t => t.type === 'income').reduce((acc, t) => acc + t.amount, 0);
            let totalExpense = transactions.filter(t => t.type === 'expense').reduce((acc, t) => acc + t.amount, 0);
            let balance = totalIncome - totalExpense;
            document.getElementById('totalBalance').innerText = '$' + balance.toFixed(2);
            document.getElementById('totalIncome').innerText = '$' + totalIncome.toFixed(2);
            document.getElementById('totalExpenses').innerText = '$' + totalExpense.toFixed(2);
            document.getElementById('totalSavings').innerText = '$' + (balance).toFixed(2);

            // monthly spent (current month)
            const now = new Date();
            const currentMonth = now.getMonth()+1;
            const currentYear = now.getFullYear();
            let monthlyExpense = transactions.filter(t => {
                if (t.type !== 'expense') return false;
                const d = new Date(t.date);
                return d.getMonth()+1 === currentMonth && d.getFullYear() === currentYear;
            }).reduce((acc, t) => acc + t.amount, 0);
            document.getElementById('monthlySpent').innerText = '$' + monthlyExpense.toFixed(2);
            document.getElementById('budgetDisplay').innerText = monthlyBudget;
            // budget warning
            const warnDiv = document.getElementById('budgetWarning');
            if (monthlyExpense > monthlyBudget) warnDiv.classList.add('show');
            else warnDiv.classList.remove('show');

            // update charts
            updateCharts();
        }

        function updateCharts() {
            // pie chart: expense categories (only expense)
            const expenseCat = {};
            transactions.filter(t => t.type === 'expense').forEach(t => {
                let cat = t.category;
                expenseCat[cat] = (expenseCat[cat] || 0) + t.amount;
            });
            const categories = Object.keys(expenseCat);
            const catValues = Object.values(expenseCat);
            if (pieChart) pieChart.destroy();
            const ctxPie = document.getElementById('pieChart').getContext('2d');
            pieChart = new Chart(ctxPie, {
                type: 'pie',
                data: {
                    labels: categories.length ? categories : ['No expenses'],
                    datasets: [{
                        data: categories.length ? catValues : [1],
                        backgroundColor: ['#3b82f6','#f97316','#10b981','#f43f5e','#8b5cf6','#eab308','#64748b'],
                        borderWidth: 0
                    }]
                },
                options: { responsive: true, maintainAspectRatio: true, plugins: { legend: { position: 'bottom' } } }
            });

            // bar chart: monthly spending (last 6 months)
            const monthsMap = {};
            const now = new Date();
            for (let i = 5; i >= 0; i--) {
                let d = new Date(now.getFullYear(), now.getMonth() - i, 1);
                let key = d.toLocaleString('default', { month: 'short' }) + ' ' + d.getFullYear().toString().slice(-2);
                monthsMap[key] = 0;
            }
            transactions.filter(t => t.type === 'expense').forEach(t => {
                let d = new Date(t.date);
                let key = d.toLocaleString('default', { month: 'short' }) + ' ' + d.getFullYear().toString().slice(-2);
                if (monthsMap.hasOwnProperty(key)) monthsMap[key] += t.amount;
            });
            if (barChart) barChart.destroy();
            const ctxBar = document.getElementById('barChart').getContext('2d');
            barChart = new Chart(ctxBar, {
                type: 'bar',
                data: {
                    labels: Object.keys(monthsMap),
                    datasets: [{
                        label: 'Spending ($)',
                        data: Object.values(monthsMap),
                        backgroundColor: '#3b82f6',
                        borderRadius: 8
                    }]
                },
                options: { responsive: true, maintainAspectRatio: true, plugins: { legend: { display: false } } }
            });
        }

        // ********** RENDER TABLE with filters **********
        function renderTable() {
            const filterCat = document.getElementById('filterCategory').value;
            let filterDate = document.getElementById('filterDate').value;
            let filtered = [...transactions];
            if (filterCat !== 'all') {
                filtered = filtered.filter(t => t.category === filterCat);
            }
            if (filterDate) {
                filtered = filtered.filter(t => t.date === filterDate);
            }
            // sort by date desc
            filtered.sort((a,b) => new Date(b.date) - new Date(a.date));

            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            if (filtered.length === 0) {
                tbody.innerHTML = '<tr class="empty-row"><td colspan="6">No transactions üïäÔ∏è add one above</td></tr>';
                return;
            }
            filtered.forEach(t => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><span class="category-badge" style="background:${t.type==='income'?'#dcfce7':'#fee2e2'}">${t.type}</span></td>
                    <td>${t.category}</td>
                    <td><strong>$${t.amount.toFixed(2)}</strong></td>
                    <td>${t.date}</td>
                    <td>${t.note || '‚Äî'}</td>
                    <td class="action-icons">
                        <i class="fas fa-edit" onclick="editTransaction(${t.id})"></i>
                        <i class="fas fa-trash-alt" onclick="deleteTransaction(${t.id})"></i>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // ********** CRUD + EDIT / DELETE **********
        window.deleteTransaction = function(id) {
            transactions = transactions.filter(t => t.id !== id);
            saveTransactions();
            updateDashboard();
            renderTable();
        };

        window.editTransaction = function(id) {
            const t = transactions.find(t => t.id === id);
            if (!t) return;
            const newAmount = prompt('Edit amount', t.amount);
            if (newAmount && !isNaN(parseFloat(newAmount))) {
                t.amount = parseFloat(newAmount);
                t.note = prompt('Edit note', t.note) || t.note;
                saveTransactions();
                updateDashboard();
                renderTable();
            }
        };

        // Add transaction
        document.getElementById('addBtn').addEventListener('click', () => {
            const type = document.getElementById('typeSelect').value;
            let amount = parseFloat(document.getElementById('amountInput').value);
            const category = document.getElementById('categorySelect').value;
            const date = document.getElementById('dateInput').value;
            const note = document.getElementById('noteInput').value;
            if (!amount || amount<=0 || !date) {
                alert('Amount and date required');
                return;
            }
            const newTrans = {
                id: Date.now(),
                type: type,
                amount: amount,
                category: category,
                date: date,
                note: note,
            };
            transactions.push(newTrans);
            saveTransactions();
            // refresh
            document.getElementById('amountInput').value = '';
            document.getElementById('noteInput').value = '';
            updateDashboard();
            renderTable();
        });

        // budget set
        document.getElementById('setBudgetBtn').addEventListener('click', () => {
            const val = parseFloat(document.getElementById('budgetLimit').value);
            if (!isNaN(val) && val>0) {
                monthlyBudget = val;
                saveBudget();
                updateDashboard();
            }
        });

        // filter events
        document.getElementById('filterCategory').addEventListener('change', renderTable);
        document.getElementById('filterDate').addEventListener('change', renderTable);
        document.getElementById('clearFilters').addEventListener('click', () => {
            document.getElementById('filterCategory').value = 'all';
            document.getElementById('filterDate').value = '';
            renderTable();
        });

        // initial load & render
        loadData();
        document.getElementById('budgetLimit').value = monthlyBudget;
        updateDashboard();
        renderTable();

        // make sure chart resizes on window (no extra)
        window.addEventListener('resize', () => { updateCharts(); });
    })();
</script>
<!-- ensure global functions for onclick -->
<script>
    // re-declare for global scope (since inside IIFE they are not global)
    window.deleteTransaction = function(id) {
        const ev = new Event('click');
        document.getElementById('addBtn').dispatchEvent(ev); // dummy, but we override below
        // actual logic already defined inside IIFE, but we need to call the internal one.
        // we simply recall the same logic by referencing the function via old school approach: rebuild list
        location.reload(); // quick fix ‚Äì but better connect
    };
    // on page load we attach again.
    (function second() {
        // just to ensure edit/delete works after IIFE, we map them to window
        const originalDelete = window.deleteTransaction;
        window.deleteTransaction = function(id) {
            let trans = JSON.parse(localStorage.getItem('pennywise_transactions') || '[]');
            trans = trans.filter(t => t.id !== id);
            localStorage.setItem('pennywise_transactions', JSON.stringify(trans));
            location.reload(); // simplest for demo
        };
        window.editTransaction = function(id) {
            let trans = JSON.parse(localStorage.getItem('pennywise_transactions') || '[]');
            const t = trans.find(t => t.id === id);
            if (t) {
                const newAmt = prompt('Edit amount', t.amount);
                if (newAmt) t.amount = parseFloat(newAmt);
                const newNote = prompt('Edit note', t.note || '');
                t.note = newNote;
                localStorage.setItem('pennywise_transactions', JSON.stringify(trans));
                location.reload();
            }
        };
    })();
</script>
</body>
</html>